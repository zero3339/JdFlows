# JDFlows ä»0å¼€å§‹å¼€å‘å®Œæ•´æŒ‡å—

> **ç‰ˆæœ¬**: 1.1.0  
> **æœ€åæ›´æ–°**: 2024-12-27  
> **ä½œè€…**: JDFlows Team  
> **æ›´æ–°å†…å®¹**: æ–°å¢UI/UXè®¾è®¡åŸåˆ™ã€ç´§å‡‘å¸ƒå±€ã€æ€§èƒ½ä¼˜åŒ–ã€å®Œæ•´ç»„ä»¶åº“

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆè¯¦è§£](#2-æŠ€æœ¯æ ˆè¯¦è§£)
3. [å¼€å‘ç¯å¢ƒæ­å»º](#3-å¼€å‘ç¯å¢ƒæ­å»º)
4. [é¡¹ç›®æ¶æ„æ·±å…¥è§£æ](#4-é¡¹ç›®æ¶æ„æ·±å…¥è§£æ)
5. [æ ¸å¿ƒæ¨¡å—å¼€å‘](#5-æ ¸å¿ƒæ¨¡å—å¼€å‘)
6. [GUIå¼€å‘æŒ‡å—](#6-guiå¼€å‘æŒ‡å—)
   - 6.1 GUIæ¶æ„æ¦‚è§ˆ
   - 6.2 UI/UXè®¾è®¡åŸåˆ™ â­ æ–°å¢
   - 6.3 æ ·å¼ç®¡ç†ç³»ç»Ÿ
   - 6.4 ç´§å‡‘å¸ƒå±€è®¾è®¡ â­ æ–°å¢
   - 6.5 å®Œæ•´ç»„ä»¶åº“ â­ æ–°å¢
   - 6.6 é¡µé¢å¼€å‘
   - 6.7 ç»„ä»¶é€šä¿¡
   - 6.8 UIæ€§èƒ½ä¼˜åŒ– â­ æ–°å¢
   - 6.9 æ•°æ®å¯è§†åŒ– â­ æ–°å¢
7. [è‡ªåŠ¨åŒ–å¼•æ“å¼€å‘](#7-è‡ªåŠ¨åŒ–å¼•æ“å¼€å‘)
8. [æ•°æ®ç®¡ç†å¼€å‘](#8-æ•°æ®ç®¡ç†å¼€å‘)
9. [æµ‹è¯•ç­–ç•¥](#9-æµ‹è¯•ç­–ç•¥)
10. [éƒ¨ç½²å’Œæ‰“åŒ…](#10-éƒ¨ç½²å’Œæ‰“åŒ…)
11. [å¼€å‘æœ€ä½³å®è·µ](#11-å¼€å‘æœ€ä½³å®è·µ)
12. [å›½é™…åŒ–æ”¯æŒ](#12-å›½é™…åŒ–æ”¯æŒ) â­ æ–°å¢
13. [å¸¸è§é—®é¢˜](#13-å¸¸è§é—®é¢˜)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯ JDFlowsï¼Ÿ

JDFlows æ˜¯ä¸€ä¸ª**ç°ä»£åŒ–æ¡Œé¢åº”ç”¨ç¨‹åº**ï¼Œä¸“é—¨ç”¨äºäº¬ä¸œå•†å“é‡‡é›†å’Œè‡ªåŠ¨åŒ–æ“ä½œã€‚å®ƒé‡‡ç”¨**Python + PyQt6 + Playwright**æŠ€æœ¯æ ˆï¼Œæä¾›äº†ï¼š

- ğŸ–¥ï¸ **åŸç”Ÿæ¡Œé¢ä½“éªŒ**ï¼šåŸºäº PyQt6 çš„ç°ä»£åŒ–ç•Œé¢
- ğŸ¤– **æ™ºèƒ½è‡ªåŠ¨åŒ–**ï¼šPlaywright é©±åŠ¨çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–
- ğŸ›¡ï¸ **åæ£€æµ‹æŠ€æœ¯**ï¼šæŒ‡çº¹ç®¡ç†ã€è¡Œä¸ºæ¨¡æ‹Ÿã€ç‰¹å¾éšè—
- ğŸ“Š **æ•°æ®ç®¡ç†**ï¼šSQLAlchemy ORM + SQLite æ•°æ®åº“
- âš¡ **å¼‚æ­¥å¤„ç†**ï¼šasyncio + qasync äº‹ä»¶å¾ªç¯é›†æˆ
- ğŸ¨ **ä¸»é¢˜ç³»ç»Ÿ**ï¼šå¯å®šåˆ¶çš„ç•Œé¢ä¸»é¢˜å’Œæ ·å¼

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

```
JDFlows åŠŸèƒ½æ¶æ„
â”œâ”€â”€ Dashboardï¼ˆä»ªè¡¨ç›˜ï¼‰    - ç³»ç»ŸçŠ¶æ€ç›‘æ§ã€å¿«æ·æ“ä½œ
â”œâ”€â”€ Browserï¼ˆæµè§ˆå™¨ï¼‰      - æµè§ˆå™¨å®ä¾‹ç®¡ç†ã€æ€§èƒ½ç›‘æ§
â”œâ”€â”€ Collectionï¼ˆé‡‡é›†ï¼‰     - å•†å“æœç´¢ã€æ•°æ®é‡‡é›†ã€ä»·æ ¼ç›‘æ§
â”œâ”€â”€ Purchaseï¼ˆè´­ä¹°ï¼‰       - ä»»åŠ¡é˜Ÿåˆ—ã€è´­ä¹°ç­–ç•¥ã€è®¢å•ç”Ÿæˆ
â”œâ”€â”€ Orderï¼ˆè®¢å•ï¼‰          - è®¢å•ç®¡ç†ã€æ•°æ®å¯¼å‡ºã€æ‰¹é‡å¤„ç†
â””â”€â”€ Settingsï¼ˆè®¾ç½®ï¼‰       - ç³»ç»Ÿé…ç½®ã€ä¸»é¢˜è®¾ç½®ã€ç”¨æˆ·åå¥½
```

### 1.3 é¡¹ç›®ç‰¹è‰²

- **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„åˆ†å±‚è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **ç±»å‹å®‰å…¨**ï¼šå…¨é¢çš„ç±»å‹æ³¨è§£å’Œ mypy ç±»å‹æ£€æŸ¥
- **å¼‚æ­¥ä¼˜å…ˆ**ï¼šåŸºäº asyncio çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹
- **å¯æµ‹è¯•æ€§**ï¼šå®Œå–„çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜ç®¡ç†ã€è™šæ‹Ÿæ»šåŠ¨ã€å»¶è¿ŸåŠ è½½

---

## 2. æŠ€æœ¯æ ˆè¯¦è§£

### 2.1 æ ¸å¿ƒä¾èµ–

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Python** | 3.11+ | ç¼–ç¨‹è¯­è¨€åŸºç¡€ |
| **PyQt6** | 6.6.0+ | GUI æ¡†æ¶ |
| **Playwright** | 1.40.0+ | æµè§ˆå™¨è‡ªåŠ¨åŒ–å¼•æ“ |
| **SQLAlchemy** | 2.0.23+ | ORM æ•°æ®åº“ç®¡ç† |
| **Pydantic** | 2.5.0+ | æ•°æ®éªŒè¯å’Œé…ç½®ç®¡ç† |
| **qasync** | 0.25.0+ | Qt å’Œ asyncio äº‹ä»¶å¾ªç¯é›†æˆ |
| **loguru** | 0.7.2+ | æ—¥å¿—ç³»ç»Ÿ |

### 2.2 å¼€å‘å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **Poetry** | ä¾èµ–ç®¡ç†å’Œæ‰“åŒ…å·¥å…· |
| **Black** | ä»£ç æ ¼å¼åŒ–ï¼ˆ88å­—ç¬¦è¡Œé•¿ï¼‰ |
| **Flake8** | ä»£ç è´¨é‡æ£€æŸ¥ |
| **mypy** | é™æ€ç±»å‹æ£€æŸ¥ |
| **pytest** | æµ‹è¯•æ¡†æ¶ |
| **pre-commit** | Git é’©å­ç®¡ç† |

### 2.3 åæ£€æµ‹æŠ€æœ¯æ ˆ

```python
åæ£€æµ‹æŠ€æœ¯å±‚æ¬¡
â”œâ”€â”€ playwright-stealth      # Playwright åæ£€æµ‹æ’ä»¶
â”œâ”€â”€ undetected-chromedriver # Chrome åæ£€æµ‹é©±åŠ¨
â”œâ”€â”€ fake-useragent         # User-Agent éšæœºåŒ–
â””â”€â”€ è‡ªå®šä¹‰æŒ‡çº¹ç®¡ç†          # Canvasã€WebGLã€Audio æŒ‡çº¹
```

---

## 3. å¼€å‘ç¯å¢ƒæ­å»º

### 3.1 ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.15+, Linux (Ubuntu 20.04+)
- **å†…å­˜**: è‡³å°‘ 8GB RAM
- **ç¡¬ç›˜**: è‡³å°‘ 2GB å¯ç”¨ç©ºé—´
- **æ˜¾ç¤ºå™¨**: 1920x1080 æˆ–æ›´é«˜åˆ†è¾¨ç‡

### 3.2 å®‰è£… Python å’Œ Poetry

#### Windows

```powershell
# å®‰è£… Python 3.11
# ä» https://www.python.org/downloads/ ä¸‹è½½å¹¶å®‰è£…

# éªŒè¯å®‰è£…
python --version  # åº”è¯¥æ˜¾ç¤º Python 3.11.x

# å®‰è£… Poetry
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -
```

#### macOS

```bash
# ä½¿ç”¨ Homebrew å®‰è£… Python
brew install python@3.11

# å®‰è£… Poetry
curl -sSL https://install.python-poetry.org | python3 -
```

#### Linux

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.11 python3.11-venv python3-pip

# å®‰è£… Poetry
curl -sSL https://install.python-poetry.org | python3 -
```

### 3.3 å…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/jdflows.git
cd jdflows

# ä½¿ç”¨ Poetry å®‰è£…ä¾èµ–ï¼ˆæ¨èï¼‰
poetry install

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
poetry shell

# æˆ–ä½¿ç”¨ pip
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# æˆ–
.venv\Scripts\activate     # Windows

pip install -r requirements.txt
```

### 3.4 å®‰è£… Playwright æµè§ˆå™¨

```bash
# å®‰è£… Chromium æµè§ˆå™¨ï¼ˆå¿…éœ€ï¼‰
playwright install chromium

# å¯é€‰ï¼šå®‰è£…æ‰€æœ‰æµè§ˆå™¨
playwright install
```

### 3.5 é…ç½®å¼€å‘å·¥å…·

```bash
# å®‰è£… pre-commit é’©å­
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰é’©å­ï¼ˆå¯é€‰ï¼‰
pre-commit run --all-files
```

### 3.6 éªŒè¯ç¯å¢ƒ

```bash
# è¿è¡Œæµ‹è¯•ä»¥éªŒè¯ç¯å¢ƒ
pytest tests/test_config.py -v

# è¿è¡Œåº”ç”¨ç¨‹åº
python main.py
```

---

## 4. é¡¹ç›®æ¶æ„æ·±å…¥è§£æ

### 4.1 ç›®å½•ç»“æ„è¯¦è§£

```
jdflows/
â”œâ”€â”€ src/                          # æºä»£ç æ ¹ç›®å½•
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ application.py        # åº”ç”¨ç¨‹åºæ ¸å¿ƒå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config.py             # é…ç½®æ•°æ®æ¨¡å‹ï¼ˆPydanticï¼‰
â”‚   â”‚   â”œâ”€â”€ config_manager.py     # é…ç½®ç®¡ç†å™¨ï¼ˆè¯»å–/å†™å…¥/éªŒè¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ logging_system.py     # é«˜çº§æ—¥å¿—åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ exceptions.py         # è‡ªå®šä¹‰å¼‚å¸¸ç±»
â”‚   â”‚   â””â”€â”€ exception_handler.py  # å…¨å±€å¼‚å¸¸å¤„ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ gui/                      # GUI ç•Œé¢æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ main_window.py        # ä¸»çª—å£ï¼ˆåº”ç”¨ç¨‹åºå…¥å£ç•Œé¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ style_manager.py      # æ ·å¼ç®¡ç†å™¨ï¼ˆä¸»é¢˜ç³»ç»Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ shared_styles.qss     # å…±äº« QSS æ ·å¼è¡¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/           # å¯å¤ç”¨ UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ base_components.py         # åŸºç¡€ç»„ä»¶ï¼ˆæŒ‰é’®ã€æ ‡ç­¾ç­‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ navigation_components.py   # å¯¼èˆªç»„ä»¶ï¼ˆä¾§è¾¹æ ç­‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ notification_components.py # é€šçŸ¥ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.py              # ä»ªè¡¨ç›˜ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ browser_widgets.py        # æµè§ˆå™¨ç®¡ç†ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ collection_widgets.py     # é‡‡é›†ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ purchase_widgets.py       # è´­ä¹°ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ order_widgets.py          # è®¢å•ç®¡ç†ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ settings_widgets.py       # è®¾ç½®é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard_page.py         # ä»ªè¡¨ç›˜é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ browser_page.py           # æµè§ˆå™¨ç®¡ç†é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ collection_page.py        # é‡‡é›†é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ purchase_page.py          # è´­ä¹°é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ order_page.py             # è®¢å•ç®¡ç†é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ settings_page.py          # è®¾ç½®é¡µé¢
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ controllers/          # æ§åˆ¶å™¨ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ layouts/              # å¸ƒå±€ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ themes/               # ä¸»é¢˜èµ„æº
â”‚   â”‚   â””â”€â”€ utils/                # GUI å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ automation/               # è‡ªåŠ¨åŒ–å¼•æ“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ browser_manager.py    # æµè§ˆå™¨å®ä¾‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ stealth_config.py     # åæ£€æµ‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ advanced_stealth.py   # é«˜çº§åæ£€æµ‹æŠ€æœ¯
â”‚   â”‚   â”œâ”€â”€ fingerprint_manager.py # æŒ‡çº¹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ page_controller.py    # é¡µé¢æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ data_extractor.py     # æ•°æ®æå–å™¨
â”‚   â”‚   â”œâ”€â”€ jd_parser.py          # äº¬ä¸œé¡µé¢è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ search_automation.py  # æœç´¢è‡ªåŠ¨åŒ–
â”‚   â”‚   â”œâ”€â”€ product_extractor.py  # å•†å“ä¿¡æ¯æå–
â”‚   â”‚   â”œâ”€â”€ price_monitor.py      # ä»·æ ¼ç›‘æ§
â”‚   â”‚   â””â”€â”€ task_scheduler.py     # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                     # æ•°æ®ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models.py             # SQLAlchemy æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ repositories.py       # æ•°æ®ä»“åº“ï¼ˆCRUD æ“ä½œï¼‰
â”‚   â”‚   â”œâ”€â”€ cache.py              # ç¼“å­˜ç®¡ç†
â”‚   â”‚   â””â”€â”€ security.py           # æ•°æ®å®‰å…¨ï¼ˆåŠ å¯†/è§£å¯†ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ helpers.py            # é€šç”¨è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ validators.py         # æ•°æ®éªŒè¯å™¨
â”‚   â”‚   â””â”€â”€ formatters.py         # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ optimization/             # æ€§èƒ½ä¼˜åŒ–æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ cache_manager.py      # ç¼“å­˜ç­–ç•¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ memory_manager.py     # å†…å­˜ç®¡ç†
â”‚   â”‚   â””â”€â”€ performance_profiler.py # æ€§èƒ½åˆ†æå™¨
â”‚   â”‚
â”‚   â””â”€â”€ testing/                  # æµ‹è¯•å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ fixtures.py           # æµ‹è¯•å¤¹å…·
â”‚       â””â”€â”€ mocks.py              # Mock å¯¹è±¡
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ conftest.py               # pytest é…ç½®å’Œå…¨å±€å¤¹å…·
â”‚   â”œâ”€â”€ test_core/                # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ test_gui/                 # GUI æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ test_automation/          # è‡ªåŠ¨åŒ–æ¨¡å—æµ‹è¯•
â”‚   â””â”€â”€ test_integration/         # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ app.json                  # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ system.json               # ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ user.json                 # ç”¨æˆ·é…ç½®
â”‚   â””â”€â”€ runtime.json              # è¿è¡Œæ—¶é…ç½®
â”‚
â”œâ”€â”€ resources/                    # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ icons/                    # å›¾æ ‡èµ„æº
â”‚   â”œâ”€â”€ images/                   # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ fonts/                    # å­—ä½“èµ„æº
â”‚
â”œâ”€â”€ docs/                         # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                      # API æ–‡æ¡£
â”‚   â”œâ”€â”€ guides/                   # å¼€å‘æŒ‡å—
â”‚   â””â”€â”€ architecture/             # æ¶æ„æ–‡æ¡£
â”‚
â”œâ”€â”€ scripts/                      # å¼€å‘è„šæœ¬
â”‚   â”œâ”€â”€ compile_ui.py             # UI æ–‡ä»¶ç¼–è¯‘
â”‚   â”œâ”€â”€ start_designer.py         # å¯åŠ¨ Qt Designer
â”‚   â””â”€â”€ dev_tools.py              # å¼€å‘å·¥å…·é›†
â”‚
â”œâ”€â”€ main.py                       # åº”ç”¨ç¨‹åºå…¥å£
â”œâ”€â”€ pyproject.toml                # Poetry é…ç½®
â”œâ”€â”€ requirements.txt              # pip ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ pytest.ini                    # pytest é…ç½®
â”œâ”€â”€ mypy.ini                      # mypy é…ç½®
â”œâ”€â”€ .flake8                       # flake8 é…ç½®
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
```

### 4.2 æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å±•ç¤ºå±‚ (Presentation)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  GUI (PyQt6)                                    â”‚   â”‚
â”‚  â”‚  - MainWindow                                   â”‚   â”‚
â”‚  â”‚  - Pages (Dashboard, Browser, Collection, ...) â”‚   â”‚
â”‚  â”‚  - Components (Widgets, Dialogs)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Controllers                                    â”‚   â”‚
â”‚  â”‚  - BrowserController                            â”‚   â”‚
â”‚  â”‚  - CollectionController                         â”‚   â”‚
â”‚  â”‚  - PurchaseController                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æœåŠ¡å±‚ (Services)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Automation     â”‚  â”‚  Data           â”‚              â”‚
â”‚  â”‚  - BrowserMgr   â”‚  â”‚  - Database     â”‚              â”‚
â”‚  â”‚  - Stealth      â”‚  â”‚  - Repositories â”‚              â”‚
â”‚  â”‚  - Extractor    â”‚  â”‚  - Cache        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŸºç¡€è®¾æ–½å±‚ (Infrastructure)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Core                                           â”‚   â”‚
â”‚  â”‚  - Application Core                             â”‚   â”‚
â”‚  â”‚  - Config Manager                               â”‚   â”‚
â”‚  â”‚  - Logger                                       â”‚   â”‚
â”‚  â”‚  - Exception Handler                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ ¸å¿ƒè®¾è®¡æ¨¡å¼

#### 4.3.1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰

ç”¨äºå…¨å±€å”¯ä¸€çš„ç®¡ç†å™¨å¯¹è±¡ï¼š

```python
# æ ·å¼ç®¡ç†å™¨å•ä¾‹
_style_manager_instance = None

def get_style_manager() -> StyleManager:
    global _style_manager_instance
    if _style_manager_instance is None:
        _style_manager_instance = StyleManager()
    return _style_manager_instance
```

#### 4.3.2 å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰

ç”¨äºåˆ›å»ºç»„ä»¶å’Œå¯¹è±¡ï¼š

```python
# æŒ‰é’®å·¥å‚
def create_primary_button(text: str, parent=None) -> StyledButton:
    button = StyledButton(text, ComponentStyle.BUTTON_PRIMARY, parent)
    return button
```

#### 4.3.3 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰

ä½¿ç”¨ Qt ä¿¡å·æ§½æœºåˆ¶å®ç°ï¼š

```python
class MainWindow(QMainWindow):
    theme_changed = pyqtSignal(str)
    
    def __init__(self):
        super().__init__()
        self.theme_changed.connect(self.on_theme_changed)
```

#### 4.3.4 ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰

ç”¨äºä¸åŒçš„åæ£€æµ‹ç­–ç•¥ï¼š

```python
class StealthStrategy(ABC):
    @abstractmethod
    async def apply(self, page: Page) -> None:
        pass

class CanvasFingerprintStrategy(StealthStrategy):
    async def apply(self, page: Page) -> None:
        # å®ç° Canvas æŒ‡çº¹éšæœºåŒ–
        pass
```

---

## 5. æ ¸å¿ƒæ¨¡å—å¼€å‘

### 5.1 åº”ç”¨ç¨‹åºæ ¸å¿ƒï¼ˆsrc/core/application.pyï¼‰

åº”ç”¨ç¨‹åºæ ¸å¿ƒè´Ÿè´£æ•´ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

#### 5.1.1 ApplicationCore ç±»

```python
"""
åº”ç”¨ç¨‹åºæ ¸å¿ƒç±»

èŒè´£:
- åˆå§‹åŒ–æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
- ç®¡ç†åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸ
- åè°ƒå„æ¨¡å—ä¹‹é—´çš„äº¤äº’
"""

class ApplicationCore(QObject):
    # ä¿¡å·å®šä¹‰
    startup_completed = pyqtSignal()
    shutdown_started = pyqtSignal()
    error_occurred = pyqtSignal(str)
    
    def __init__(self):
        super().__init__()
        self.settings: Optional[Settings] = None
        self.config_manager = None
        self.logger = None
        self.main_window: Optional[ModernMainWindow] = None
        self._initialized = False
        self._shutdown_requested = False
    
    async def initialize(self) -> None:
        """åˆå§‹åŒ–åº”ç”¨ç¨‹åºæ ¸å¿ƒç»„ä»¶"""
        try:
            # 1. åˆå§‹åŒ–é…ç½®ç®¡ç†å™¨
            self.config_manager = get_config_manager()
            
            # 2. åŠ è½½é…ç½®
            self.settings = Settings()
            
            # 3. è®¾ç½®æ—¥å¿—ç³»ç»Ÿ
            setup_logger(self.settings)
            self.logger = get_logger("ApplicationCore")
            
            # 4. åˆ›å»ºä¸»çª—å£
            self.main_window = ModernMainWindow(self.settings)
            self.main_window.window_closed.connect(self.request_shutdown)
            
            self._initialized = True
            self.startup_completed.emit()
            
        except Exception as e:
            error_msg = f"åº”ç”¨ç¨‹åºåˆå§‹åŒ–å¤±è´¥: {e}"
            if self.logger:
                self.logger.error(error_msg)
            self.error_occurred.emit(error_msg)
            raise JDFlowsError(error_msg)
```

#### 5.1.2 JDFlowsApplication ç±»

```python
"""
åº”ç”¨ç¨‹åºä¸»ç±»

èŒè´£:
- åˆ›å»º Qt åº”ç”¨ç¨‹åº
- è®¾ç½® qasync äº‹ä»¶å¾ªç¯
- è¿è¡Œåº”ç”¨ç¨‹åº
"""

class JDFlowsApplication:
    def __init__(self):
        self.qt_app: Optional[QApplication] = None
        self.event_loop: Optional[asyncio.AbstractEventLoop] = None
        self.core: Optional[ApplicationCore] = None
    
    def run(self) -> int:
        """è¿è¡Œåº”ç”¨ç¨‹åº"""
        try:
            # åˆ›å»º Qt åº”ç”¨ç¨‹åº
            self.qt_app = QApplication(sys.argv)
            
            # è®¾ç½® qasync äº‹ä»¶å¾ªç¯
            self.event_loop = qasync.QEventLoop(self.qt_app)
            asyncio.set_event_loop(self.event_loop)
            
            # è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°
            return self.event_loop.run_until_complete(self.run_async())
            
        except KeyboardInterrupt:
            return 0
        except Exception as e:
            print(f"åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥: {e}")
            return 1
```

### 5.2 é…ç½®ç®¡ç†ï¼ˆsrc/core/config.py & config_manager.pyï¼‰

#### 5.2.1 é…ç½®æ•°æ®æ¨¡å‹ï¼ˆPydanticï¼‰

```python
"""
é…ç½®æ•°æ®æ¨¡å‹

ä½¿ç”¨ Pydantic è¿›è¡Œæ•°æ®éªŒè¯å’Œç±»å‹å®‰å…¨
"""

from pydantic import BaseModel, Field

class AppConfig(BaseModel):
    """åº”ç”¨é…ç½®"""
    name: str = Field(default="JDFlows")
    version: str = Field(default="0.1.0")
    debug: bool = Field(default=False)

class DatabaseConfig(BaseModel):
    """æ•°æ®åº“é…ç½®"""
    url: str = Field(default="sqlite:///data/jdflows.db")
    echo: bool = Field(default=False)
    pool_size: int = Field(default=5, ge=1, le=20)

class BrowserConfig(BaseModel):
    """æµè§ˆå™¨é…ç½®"""
    headless: bool = Field(default=False)
    timeout: int = Field(default=30000, ge=1000)
    user_data_dir: str = Field(default="data/browser")

class Settings(BaseModel):
    """ä¸»é…ç½®ç±»"""
    app: AppConfig = Field(default_factory=AppConfig)
    database: DatabaseConfig = Field(default_factory=DatabaseConfig)
    browser: BrowserConfig = Field(default_factory=BrowserConfig)
```

#### 5.2.2 é…ç½®ç®¡ç†å™¨

```python
"""
é…ç½®ç®¡ç†å™¨

èŒè´£:
- è¯»å–/å†™å…¥é…ç½®æ–‡ä»¶
- åˆå¹¶å¤šå±‚é…ç½®
- éªŒè¯é…ç½®æœ‰æ•ˆæ€§
"""

class ConfigManager:
    def __init__(self, config_dir: Path = Path("config")):
        self.config_dir = config_dir
        self.config_files = {
            "app": config_dir / "app.json",
            "system": config_dir / "system.json",
            "user": config_dir / "user.json",
            "runtime": config_dir / "runtime.json",
        }
    
    def load_config(self) -> Settings:
        """åŠ è½½æ‰€æœ‰é…ç½®æ–‡ä»¶å¹¶åˆå¹¶"""
        merged = {}
        
        for name, file_path in self.config_files.items():
            if file_path.exists():
                with open(file_path, "r", encoding="utf-8") as f:
                    config = json.load(f)
                    merged.update(config)
        
        return Settings(**merged)
    
    def save_config(self, settings: Settings) -> None:
        """ä¿å­˜é…ç½®"""
        # å®ç°é…ç½®ä¿å­˜é€»è¾‘
        pass
```

### 5.3 æ—¥å¿—ç³»ç»Ÿï¼ˆsrc/core/logger.pyï¼‰

```python
"""
æ—¥å¿—ç³»ç»Ÿ

ä½¿ç”¨ loguru å®ç°å¼ºå¤§çš„æ—¥å¿—åŠŸèƒ½
"""

from loguru import logger
import sys

def setup_logger(settings: Settings) -> None:
    """è®¾ç½®æ—¥å¿—ç³»ç»Ÿ"""
    # ç§»é™¤é»˜è®¤å¤„ç†å™¨
    logger.remove()
    
    # æ§åˆ¶å°è¾“å‡º
    logger.add(
        sys.stderr,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | "
               "<level>{level: <8}</level> | "
               "<cyan>{name}</cyan>:<cyan>{function}</cyan> - "
               "<level>{message}</level>",
        level="DEBUG" if settings.app.debug else "INFO",
    )
    
    # æ–‡ä»¶è¾“å‡º
    logger.add(
        "logs/jdflows_{time}.log",
        rotation="100 MB",
        retention="30 days",
        compression="zip",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function} - {message}",
        level="DEBUG",
    )

def get_logger(name: str):
    """è·å– logger å®ä¾‹"""
    return logger.bind(name=name)
```

---

## 6. GUIå¼€å‘æŒ‡å—

### 6.1 GUI æ¶æ„æ¦‚è§ˆ

JDFlows çš„ GUI é‡‡ç”¨**ç»„ä»¶åŒ–**å’Œ**é¡µé¢åŒ–**çš„è®¾è®¡ï¼š

```
GUI æ¶æ„
â”œâ”€â”€ MainWindowï¼ˆä¸»çª—å£ï¼‰
â”‚   â”œâ”€â”€ NavigationSidebarï¼ˆå¯¼èˆªä¾§è¾¹æ ï¼‰
â”‚   â”œâ”€â”€ ContentAreaï¼ˆå†…å®¹åŒºåŸŸ - QStackedWidgetï¼‰
â”‚   â”‚   â”œâ”€â”€ DashboardPage
â”‚   â”‚   â”œâ”€â”€ BrowserPage
â”‚   â”‚   â”œâ”€â”€ CollectionPage
â”‚   â”‚   â”œâ”€â”€ PurchasePage
â”‚   â”‚   â”œâ”€â”€ OrderPage
â”‚   â”‚   â””â”€â”€ SettingsPage
â”‚   â””â”€â”€ StatusBarï¼ˆçŠ¶æ€æ ï¼‰
â”‚
â””â”€â”€ StyleManagerï¼ˆæ ·å¼ç®¡ç†å™¨ï¼‰
    â”œâ”€â”€ ä¸»é¢˜ç³»ç»Ÿï¼ˆLight/Dark/Neutral/Terminalï¼‰
    â””â”€â”€ ç»„ä»¶æ ·å¼ï¼ˆComponentStyleæšä¸¾ï¼‰
```

### 6.2 UI/UX è®¾è®¡åŸåˆ™

#### 6.2.1 å“åº”å¼è®¾è®¡

```python
"""
å“åº”å¼å¸ƒå±€ç®¡ç†

æ ¹æ®çª—å£å¤§å°è‡ªåŠ¨è°ƒæ•´å¸ƒå±€
"""

class ResponsiveWidget(StyledWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.breakpoints = {
            "xs": 480,   # è¶…å°å±å¹•
            "sm": 768,   # å°å±å¹•
            "md": 1024,  # ä¸­ç­‰å±å¹•
            "lg": 1440,  # å¤§å±å¹•
            "xl": 1920   # è¶…å¤§å±å¹•
        }
        self.current_breakpoint = "lg"
    
    def resizeEvent(self, event):
        """çª—å£å¤§å°æ”¹å˜æ—¶è§¦å‘"""
        super().resizeEvent(event)
        width = event.size().width()
        
        # ç¡®å®šå½“å‰æ–­ç‚¹
        if width < self.breakpoints["xs"]:
            self.current_breakpoint = "xs"
        elif width < self.breakpoints["sm"]:
            self.current_breakpoint = "sm"
        elif width < self.breakpoints["md"]:
            self.current_breakpoint = "md"
        elif width < self.breakpoints["lg"]:
            self.current_breakpoint = "lg"
        else:
            self.current_breakpoint = "xl"
        
        # åº”ç”¨å“åº”å¼å¸ƒå±€
        self.apply_responsive_layout()
    
    def apply_responsive_layout(self):
        """æ ¹æ®æ–­ç‚¹åº”ç”¨ä¸åŒå¸ƒå±€"""
        if self.current_breakpoint in ["xs", "sm"]:
            # ç§»åŠ¨ç«¯å¸ƒå±€ï¼šå•åˆ—
            self.set_mobile_layout()
        else:
            # æ¡Œé¢ç«¯å¸ƒå±€ï¼šå¤šåˆ—
            self.set_desktop_layout()
```

#### 6.2.2 é«˜ DPI æ”¯æŒ

```python
"""
é«˜ DPI å±å¹•æ”¯æŒ

ç¡®ä¿åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸‹æ˜¾ç¤ºæ¸…æ™°
"""

# main.py
import sys
from PyQt6.QtWidgets import QApplication
from PyQt6.QtCore import Qt

def setup_high_dpi():
    """è®¾ç½®é«˜ DPI æ”¯æŒ"""
    # å¯ç”¨é«˜ DPI ç¼©æ”¾
    QApplication.setHighDpiScaleFactorRoundingPolicy(
        Qt.HighDpiScaleFactorRoundingPolicy.PassThrough
    )
    
    # å¯ç”¨é«˜ DPI pixmaps
    QApplication.setAttribute(Qt.ApplicationAttribute.AA_UseHighDpiPixmaps)
    QApplication.setAttribute(Qt.ApplicationAttribute.AA_EnableHighDpiScaling)

# åœ¨åˆ›å»º QApplication ä¹‹å‰è°ƒç”¨
setup_high_dpi()
app = QApplication(sys.argv)

# è·å–å±å¹• DPI æ¯”ä¾‹
screen = app.primaryScreen()
dpi_ratio = screen.devicePixelRatio()
print(f"DPI æ¯”ä¾‹: {dpi_ratio}")

# æ ¹æ® DPI è°ƒæ•´å­—ä½“å’Œå›¾æ ‡å¤§å°
base_font_size = 14
scaled_font_size = int(base_font_size * dpi_ratio)
```

#### 6.2.3 æ— éšœç¢è®¿é—®ï¼ˆAccessibilityï¼‰

```python
"""
æ— éšœç¢è®¿é—®æ”¯æŒ

ç¡®ä¿åº”ç”¨å¯è¢«æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨
"""

class AccessibleButton(QPushButton):
    def __init__(self, text: str, accessible_name: str = None,
                 accessible_description: str = None, parent=None):
        super().__init__(text, parent)
        
        # è®¾ç½®æ— éšœç¢å±æ€§
        self.setAccessibleName(accessible_name or text)
        if accessible_description:
            self.setAccessibleDescription(accessible_description)
        
        # ç¡®ä¿å¯é€šè¿‡é”®ç›˜è®¿é—®
        self.setFocusPolicy(Qt.FocusPolicy.StrongFocus)
    
    def keyPressEvent(self, event):
        """é”®ç›˜äº‹ä»¶å¤„ç†"""
        # æ”¯æŒç©ºæ ¼é”®å’Œå›è½¦é”®è§¦å‘
        if event.key() in [Qt.Key.Key_Space, Qt.Key.Key_Return, Qt.Key.Key_Enter]:
            self.click()
        else:
            super().keyPressEvent(event)

# ä½¿ç”¨ç¤ºä¾‹
button = AccessibleButton(
    "å¯åŠ¨é‡‡é›†",
    accessible_name="å¯åŠ¨å•†å“é‡‡é›†æŒ‰é’®",
    accessible_description="ç‚¹å‡»æ­¤æŒ‰é’®å¼€å§‹é‡‡é›†äº¬ä¸œå•†å“ä¿¡æ¯"
)

# è®¾ç½®å¿«æ·é”®
button.setShortcut(QKeySequence("Ctrl+S"))
button.setToolTip("å¯åŠ¨é‡‡é›† (Ctrl+S)")
```

#### 6.2.4 é¢œè‰²å¯¹æ¯”åº¦å’Œ WCAG åˆè§„

```python
"""
é¢œè‰²å¯¹æ¯”åº¦æ£€æŸ¥

ç¡®ä¿ç¬¦åˆ WCAG 2.1 AA æ ‡å‡†
"""

from typing import Tuple

class ColorContrast:
    @staticmethod
    def relative_luminance(rgb: Tuple[int, int, int]) -> float:
        """è®¡ç®—ç›¸å¯¹äº®åº¦"""
        def linearize(channel: int) -> float:
            c = channel / 255.0
            if c <= 0.03928:
                return c / 12.92
            return ((c + 0.055) / 1.055) ** 2.4
        
        r, g, b = rgb
        return 0.2126 * linearize(r) + 0.7152 * linearize(g) + 0.0722 * linearize(b)
    
    @staticmethod
    def contrast_ratio(color1: Tuple[int, int, int], 
                      color2: Tuple[int, int, int]) -> float:
        """è®¡ç®—å¯¹æ¯”åº¦"""
        l1 = ColorContrast.relative_luminance(color1)
        l2 = ColorContrast.relative_luminance(color2)
        
        lighter = max(l1, l2)
        darker = min(l1, l2)
        
        return (lighter + 0.05) / (darker + 0.05)
    
    @staticmethod
    def meets_wcag_aa(color1: Tuple[int, int, int], 
                     color2: Tuple[int, int, int],
                     is_large_text: bool = False) -> bool:
        """æ£€æŸ¥æ˜¯å¦ç¬¦åˆ WCAG AA æ ‡å‡†"""
        ratio = ColorContrast.contrast_ratio(color1, color2)
        
        # å¤§æ–‡æœ¬éœ€è¦ 3:1ï¼Œæ™®é€šæ–‡æœ¬éœ€è¦ 4.5:1
        threshold = 3.0 if is_large_text else 4.5
        return ratio >= threshold

# ä½¿ç”¨ç¤ºä¾‹
bg_color = (30, 30, 30)    # æ·±ç°èƒŒæ™¯
text_color = (255, 255, 255)  # ç™½è‰²æ–‡æœ¬

if ColorContrast.meets_wcag_aa(bg_color, text_color):
    print("âœ“ é¢œè‰²å¯¹æ¯”åº¦ç¬¦åˆ WCAG AA æ ‡å‡†")
else:
    print("âœ— é¢œè‰²å¯¹æ¯”åº¦ä¸ç¬¦åˆæ ‡å‡†ï¼Œè¯·è°ƒæ•´é…è‰²")
```

### 6.3 æ ·å¼ç®¡ç†ç³»ç»Ÿ

#### 6.3.1 StyleManager ç±»

```python
"""
æ ·å¼ç®¡ç†å™¨

èŒè´£:
- ç®¡ç†åº”ç”¨ä¸»é¢˜
- åº”ç”¨ç»„ä»¶æ ·å¼
- åŠ¨æ€åˆ‡æ¢ä¸»é¢˜
"""

class StyleManager(QObject):
    theme_changed = pyqtSignal(str)
    
    def __init__(self):
        super().__init__()
        self.current_theme = ThemeType.DARK
        self.themes = self._load_themes()
        self.component_styles = self._load_component_styles()
    
    def set_theme(self, widget: QWidget, theme: str) -> None:
        """åº”ç”¨ä¸»é¢˜åˆ°ç»„ä»¶"""
        if theme in self.themes:
            stylesheet = self.themes[theme]
            widget.setStyleSheet(stylesheet)
            self.current_theme = theme
            self.theme_changed.emit(theme)
    
    def apply_component_style(self, widget: QWidget, style_class: str) -> None:
        """åº”ç”¨ç»„ä»¶æ ·å¼ç±»"""
        current = widget.property("styleClass") or []
        if style_class not in current:
            current.append(style_class)
            widget.setProperty("styleClass", current)
            widget.style().unpolish(widget)
            widget.style().polish(widget)
```

#### 6.2.2 QSS æ ·å¼è¡¨

```qss
/* shared_styles.qss */

/* ========== ä¸»é¢˜å˜é‡ ========== */
/* Dark Theme */
.dark {
    qproperty-backgroundColor: #1e1e1e;
    qproperty-foregroundColor: #ffffff;
    qproperty-accentColor: #0078d4;
}

/* ========== åŸºç¡€ç»„ä»¶ ========== */
QWidget {
    background-color: #1e1e1e;
    color: #ffffff;
    font-family: "Segoe UI", "Microsoft YaHei UI", sans-serif;
    font-size: 14px;
}

/* ========== æŒ‰é’®æ ·å¼ ========== */
QPushButton.btn-primary {
    background-color: #0078d4;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 8px 16px;
    font-weight: 600;
}

QPushButton.btn-primary:hover {
    background-color: #106ebe;
}

QPushButton.btn-primary:pressed {
    background-color: #005a9e;
}
```

### 6.3 åŸºç¡€ç»„ä»¶å¼€å‘

#### 6.3.1 StyledWidget åŸºç±»

```python
"""
åŸºç¡€æ ·å¼åŒ–ç»„ä»¶

æ‰€æœ‰è‡ªå®šä¹‰ç»„ä»¶ç»§æ‰¿æ­¤ç±»
"""

class StyledWidget(QWidget):
    value_changed = pyqtSignal(object)
    action_triggered = pyqtSignal(str)
    theme_changed = pyqtSignal(str)
    
    def __init__(self, parent: Optional[QWidget] = None):
        super().__init__(parent)
        self.logger = get_logger(self.__class__.__name__)
        self.style_manager = get_style_manager()
        self._current_theme = ThemeType.DARK
        
        # åº”ç”¨é»˜è®¤ä¸»é¢˜
        self.apply_theme(self._current_theme)
        
        # ç›‘å¬ä¸»é¢˜å˜åŒ–
        self.style_manager.theme_changed.connect(self.on_theme_changed)
    
    def apply_theme(self, theme: str) -> None:
        """åº”ç”¨ä¸»é¢˜"""
        self.style_manager.set_theme(self, theme)
        self._current_theme = theme
    
    def apply_component_style(self, style_class: str) -> None:
        """åº”ç”¨ç»„ä»¶æ ·å¼ç±»"""
        self.style_manager.apply_component_style(self, style_class)
```

#### 6.3.2 StyledButton ç»„ä»¶

```python
"""
æ ·å¼åŒ–æŒ‰é’®ç»„ä»¶
"""

class StyledButton(QPushButton):
    def __init__(self, text: str, style_class: str = ComponentStyle.BUTTON_DEFAULT,
                 parent: Optional[QWidget] = None):
        super().__init__(text, parent)
        self.style_manager = get_style_manager()
        
        # åº”ç”¨æ ·å¼ç±»
        self.apply_component_style(style_class)
        
        # è®¾ç½®å…‰æ ‡
        self.setCursor(Qt.CursorShape.PointingHandCursor)
    
    def apply_component_style(self, style_class: str) -> None:
        """åº”ç”¨æ ·å¼ç±»"""
        self.style_manager.apply_component_style(self, style_class)
```

### 6.4 é¡µé¢å¼€å‘

#### 6.4.1 é¡µé¢åŸºç±»

```python
"""
é¡µé¢åŸºç±»

æ‰€æœ‰é¡µé¢ç»§æ‰¿æ­¤ç±»
"""

class BasePage(StyledWidget):
    def __init__(self, parent: Optional[QWidget] = None):
        super().__init__(parent)
        self.logger = get_logger(self.__class__.__name__)
        self.init_ui()
    
    def init_ui(self) -> None:
        """åˆå§‹åŒ–UI - å­ç±»å®ç°"""
        raise NotImplementedError
    
    def on_activated(self) -> None:
        """é¡µé¢æ¿€æ´»æ—¶è°ƒç”¨ - å­ç±»å¯é€‰å®ç°"""
        pass
    
    def on_deactivated(self) -> None:
        """é¡µé¢å¤±æ´»æ—¶è°ƒç”¨ - å­ç±»å¯é€‰å®ç°"""
        pass
```

#### 6.4.2 Dashboard é¡µé¢ç¤ºä¾‹

```python
"""
ä»ªè¡¨ç›˜é¡µé¢

æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€ã€å…³é”®æŒ‡æ ‡å’Œå¿«æ·æ“ä½œ
"""

class DashboardPage(BasePage):
    def init_ui(self) -> None:
        """åˆå§‹åŒ–UI"""
        # ä¸»å¸ƒå±€
        layout = QVBoxLayout(self)
        layout.setSpacing(16)
        layout.setContentsMargins(20, 20, 20, 20)
        
        # æ ‡é¢˜
        title = create_title_label("ç³»ç»Ÿä»ªè¡¨ç›˜")
        layout.addWidget(title)
        
        # æŒ‡æ ‡å¡ç‰‡åŒºåŸŸ
        metrics_layout = QGridLayout()
        metrics_layout.setSpacing(16)
        
        # åˆ›å»ºæŒ‡æ ‡å¡ç‰‡
        self.cpu_card = MetricCard("CPUä½¿ç”¨ç‡", "0%", trend="æ­£å¸¸")
        self.memory_card = MetricCard("å†…å­˜ä½¿ç”¨", "0 MB", trend="æ­£å¸¸")
        self.tasks_card = MetricCard("è¿è¡Œä»»åŠ¡", "0", trend="æ— ")
        self.status_card = MetricCard("ç³»ç»ŸçŠ¶æ€", "å°±ç»ª", trend="æ­£å¸¸")
        
        metrics_layout.addWidget(self.cpu_card, 0, 0)
        metrics_layout.addWidget(self.memory_card, 0, 1)
        metrics_layout.addWidget(self.tasks_card, 1, 0)
        metrics_layout.addWidget(self.status_card, 1, 1)
        
        layout.addLayout(metrics_layout)
        
        # å¿«æ·æ“ä½œåŒºåŸŸ
        actions_group = self.create_actions_section()
        layout.addWidget(actions_group)
        
        # å¼¹æ€§ç©ºé—´
        layout.addStretch()
    
    def create_actions_section(self) -> QWidget:
        """åˆ›å»ºå¿«æ·æ“ä½œåŒºåŸŸ"""
        group = QGroupBox("å¿«æ·æ“ä½œ")
        layout = QHBoxLayout(group)
        
        start_btn = create_primary_button("å¯åŠ¨é‡‡é›†")
        start_btn.clicked.connect(self.on_start_collection)
        
        stop_btn = StyledButton("åœæ­¢ä»»åŠ¡", ComponentStyle.BUTTON_DANGER)
        stop_btn.clicked.connect(self.on_stop_tasks)
        
        layout.addWidget(start_btn)
        layout.addWidget(stop_btn)
        layout.addStretch()
        
        return group
    
    def on_start_collection(self):
        """å¯åŠ¨é‡‡é›†"""
        self.logger.info("å¯åŠ¨é‡‡é›†ä»»åŠ¡")
        # å®ç°é‡‡é›†é€»è¾‘
```

### 6.5 ç»„ä»¶é€šä¿¡

#### 6.5.1 ä¿¡å·æ§½æœºåˆ¶

```python
# å®šä¹‰ä¿¡å·
class CollectionPage(BasePage):
    collection_started = pyqtSignal(dict)  # é‡‡é›†å¼€å§‹ä¿¡å·
    collection_completed = pyqtSignal(dict)  # é‡‡é›†å®Œæˆä¿¡å·
    
    def start_collection(self, keyword: str):
        # å‘å°„ä¿¡å·
        self.collection_started.emit({"keyword": keyword})
        
        # æ‰§è¡Œé‡‡é›†é€»è¾‘
        # ...
        
        # å®Œæˆåå‘å°„ä¿¡å·
        self.collection_completed.emit({"count": 100})

# è¿æ¥ä¿¡å·
page = CollectionPage()
page.collection_started.connect(lambda data: print(f"å¼€å§‹é‡‡é›†: {data}"))
page.collection_completed.connect(lambda data: print(f"é‡‡é›†å®Œæˆ: {data}"))
```

#### 6.5.2 äº‹ä»¶æ€»çº¿

```python
"""
äº‹ä»¶æ€»çº¿ - å…¨å±€äº‹ä»¶é€šä¿¡

ç”¨äºè·¨ç»„ä»¶çš„æ¾è€¦åˆé€šä¿¡
"""

class EventBus(QObject):
    _instance = None
    event_emitted = pyqtSignal(str, object)
    
    @classmethod
    def get_instance(cls):
        if cls._instance is None:
            cls._instance = cls()
        return cls._instance
    
    def emit_event(self, event_type: str, data: Any = None):
        """å‘å°„äº‹ä»¶"""
        self.event_emitted.emit(event_type, data)
    
    def subscribe(self, event_type: str, handler: callable):
        """è®¢é˜…äº‹ä»¶"""
        self.event_emitted.connect(
            lambda etype, data: handler(data) if etype == event_type else None
        )

# ä½¿ç”¨ç¤ºä¾‹
bus = EventBus.get_instance()

# è®¢é˜…äº‹ä»¶
bus.subscribe("collection_completed", lambda data: print(f"é‡‡é›†å®Œæˆ: {data}"))

# å‘å°„äº‹ä»¶
bus.emit_event("collection_completed", {"count": 100})
```

---

## 7. è‡ªåŠ¨åŒ–å¼•æ“å¼€å‘

### 7.1 æµè§ˆå™¨ç®¡ç†å™¨

#### 7.1.1 BrowserManager ç±»

```python
"""
æµè§ˆå™¨ç®¡ç†å™¨

èŒè´£:
- åˆ›å»ºå’Œç®¡ç† Playwright æµè§ˆå™¨å®ä¾‹
- é…ç½®åæ£€æµ‹æŠ€æœ¯
- ç›‘æ§æµè§ˆå™¨æ€§èƒ½
"""

class BrowserManager:
    def __init__(self, settings: Settings):
        self.settings = settings
        self.logger = get_logger("BrowserManager")
        self.instances: Dict[str, BrowserInstance] = {}
        self._playwright = None
        self._browser_type = None
    
    async def initialize(self) -> None:
        """åˆå§‹åŒ– Playwright"""
        from playwright.async_api import async_playwright
        
        self._playwright = await async_playwright().start()
        self._browser_type = self._playwright.chromium
        self.logger.info("Playwright åˆå§‹åŒ–æˆåŠŸ")
    
    async def create_instance(self, instance_id: str,
                             use_stealth: bool = True) -> BrowserInstance:
        """åˆ›å»ºæµè§ˆå™¨å®ä¾‹"""
        try:
            # åˆ›å»ºæµè§ˆå™¨
            browser = await self._browser_type.launch(
                headless=self.settings.browser.headless,
                args=[
                    "--disable-blink-features=AutomationControlled",
                    "--no-sandbox",
                ]
            )
            
            # åˆ›å»ºä¸Šä¸‹æ–‡
            context = await browser.new_context(
                viewport={"width": 1920, "height": 1080},
                user_agent=self._generate_user_agent(),
            )
            
            # åˆ›å»ºé¡µé¢
            page = await context.new_page()
            
            # åº”ç”¨åæ£€æµ‹
            if use_stealth:
                await self._apply_stealth(page)
            
            # åˆ›å»ºå®ä¾‹å¯¹è±¡
            instance = BrowserInstance(
                instance_id=instance_id,
                status=BrowserStatus.RUNNING,
                browser=browser,
                context=context,
                page=page,
                created_at=time.time(),
            )
            
            self.instances[instance_id] = instance
            self.logger.info(f"æµè§ˆå™¨å®ä¾‹ {instance_id} åˆ›å»ºæˆåŠŸ")
            
            return instance
            
        except Exception as e:
            self.logger.error(f"åˆ›å»ºæµè§ˆå™¨å®ä¾‹å¤±è´¥: {e}")
            raise BrowserError(f"åˆ›å»ºæµè§ˆå™¨å®ä¾‹å¤±è´¥: {e}")
```

### 7.2 åæ£€æµ‹æŠ€æœ¯

#### 7.2.1 åŸºç¡€åæ£€æµ‹é…ç½®

```python
"""
åæ£€æµ‹é…ç½®

å®ç°å„ç§åæ£€æµ‹æŠ€æœ¯
"""

class AntiDetectionConfig:
    @staticmethod
    async def hide_webdriver(page: Page) -> None:
        """éšè— WebDriver ç‰¹å¾"""
        await page.add_init_script("""
            Object.defineProperty(navigator, 'webdriver', {
                get: () => undefined
            });
        """)
    
    @staticmethod
    async def spoof_permissions(page: Page) -> None:
        """ä¼ªè£…æƒé™"""
        await page.add_init_script("""
            const originalQuery = window.navigator.permissions.query;
            window.navigator.permissions.query = (parameters) => (
                parameters.name === 'notifications' ?
                    Promise.resolve({ state: Notification.permission }) :
                    originalQuery(parameters)
            );
        """)
    
    @staticmethod
    async def randomize_canvas_fingerprint(page: Page) -> None:
        """Canvas æŒ‡çº¹éšæœºåŒ–"""
        await page.add_init_script("""
            const getContext = HTMLCanvasElement.prototype.getContext;
            HTMLCanvasElement.prototype.getContext = function(...args) {
                const context = getContext.apply(this, args);
                if (args[0] === '2d') {
                    const getImageData = context.getImageData;
                    context.getImageData = function(...args) {
                        const imageData = getImageData.apply(this, args);
                        // æ·»åŠ å¾®å°å™ªå£°
                        for (let i = 0; i < imageData.data.length; i += 4) {
                            imageData.data[i] += Math.random() * 0.01;
                        }
                        return imageData;
                    };
                }
                return context;
            };
        """)
```

#### 7.2.2 é«˜çº§åæ£€æµ‹ç­–ç•¥

```python
"""
é«˜çº§åæ£€æµ‹ç­–ç•¥

å®ç°æ›´å¤æ‚çš„åæ£€æµ‹æŠ€æœ¯
"""

class AdvancedStealth:
    def __init__(self):
        self.logger = get_logger("AdvancedStealth")
    
    async def apply_all(self, page: Page) -> None:
        """åº”ç”¨æ‰€æœ‰åæ£€æµ‹æŠ€æœ¯"""
        await self.hide_automation_features(page)
        await self.randomize_fingerprints(page)
        await self.simulate_human_behavior(page)
    
    async def simulate_human_behavior(self, page: Page) -> None:
        """æ¨¡æ‹Ÿäººç±»è¡Œä¸º"""
        # éšæœºé¼ æ ‡ç§»åŠ¨
        await page.mouse.move(
            random.randint(100, 800),
            random.randint(100, 600),
            steps=random.randint(5, 15)
        )
        
        # éšæœºå»¶è¿Ÿ
        await asyncio.sleep(random.uniform(0.1, 0.5))
```

### 7.3 æ•°æ®æå–å™¨

```python
"""
æ•°æ®æå–å™¨

ä»é¡µé¢ä¸­æå–å•†å“ä¿¡æ¯
"""

class ProductExtractor:
    def __init__(self, browser_manager: BrowserManager):
        self.browser_manager = browser_manager
        self.logger = get_logger("ProductExtractor")
    
    async def extract_product_info(self, page: Page, url: str) -> Dict[str, Any]:
        """æå–å•†å“ä¿¡æ¯"""
        try:
            # å¯¼èˆªåˆ°å•†å“é¡µé¢
            await page.goto(url, wait_until="networkidle")
            
            # æå–å•†å“ä¿¡æ¯
            product_info = await page.evaluate("""() => {
                return {
                    title: document.querySelector('.sku-name')?.textContent.trim(),
                    price: document.querySelector('.price')?.textContent.trim(),
                    stock: document.querySelector('.stock')?.textContent.trim(),
                    images: Array.from(document.querySelectorAll('.img-item img'))
                               .map(img => img.src),
                };
            }""")
            
            self.logger.info(f"æˆåŠŸæå–å•†å“ä¿¡æ¯: {product_info['title']}")
            return product_info
            
        except Exception as e:
            self.logger.error(f"æå–å•†å“ä¿¡æ¯å¤±è´¥: {e}")
            raise
```

---

## 8. æ•°æ®ç®¡ç†å¼€å‘

### 8.1 æ•°æ®æ¨¡å‹ï¼ˆSQLAlchemyï¼‰

```python
"""
æ•°æ®æ¨¡å‹

å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„
"""

from sqlalchemy import Column, Integer, String, Float, DateTime, Text, Boolean
from sqlalchemy.ext.declarative import declarative_base
from datetime import datetime

Base = declarative_base()

class Product(Base):
    """å•†å“æ¨¡å‹"""
    __tablename__ = "products"
    
    id = Column(Integer, primary_key=True)
    sku_id = Column(String(50), unique=True, nullable=False, index=True)
    title = Column(String(500), nullable=False)
    price = Column(Float, nullable=False)
    original_price = Column(Float)
    stock_status = Column(String(50))
    shop_name = Column(String(200))
    category = Column(String(100))
    images = Column(Text)  # JSON æ ¼å¼å­˜å‚¨
    description = Column(Text)
    url = Column(String(500))
    created_at = Column(DateTime, default=datetime.now)
    updated_at = Column(DateTime, default=datetime.now, onupdate=datetime.now)
    
    def __repr__(self):
        return f"<Product(sku_id='{self.sku_id}', title='{self.title}')>"

class Order(Base):
    """è®¢å•æ¨¡å‹"""
    __tablename__ = "orders"
    
    id = Column(Integer, primary_key=True)
    order_id = Column(String(50), unique=True, nullable=False)
    product_sku = Column(String(50), nullable=False)
    quantity = Column(Integer, default=1)
    total_price = Column(Float, nullable=False)
    status = Column(String(20), default="pending")  # pending, completed, failed
    created_at = Column(DateTime, default=datetime.now)
    completed_at = Column(DateTime)
    
    def __repr__(self):
        return f"<Order(order_id='{self.order_id}', status='{self.status}')>"
```

### 8.2 æ•°æ®åº“ç®¡ç†

```python
"""
æ•°æ®åº“ç®¡ç†å™¨

ç®¡ç†æ•°æ®åº“è¿æ¥å’Œä¼šè¯
"""

from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, Session
from contextlib import contextmanager

class DatabaseManager:
    def __init__(self, database_url: str):
        self.engine = create_engine(
            database_url,
            echo=False,
            pool_size=5,
            max_overflow=10,
        )
        self.SessionLocal = sessionmaker(
            autocommit=False,
            autoflush=False,
            bind=self.engine
        )
        self.logger = get_logger("DatabaseManager")
    
    def create_tables(self) -> None:
        """åˆ›å»ºæ‰€æœ‰è¡¨"""
        Base.metadata.create_all(bind=self.engine)
        self.logger.info("æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ")
    
    @contextmanager
    def get_session(self) -> Session:
        """è·å–æ•°æ®åº“ä¼šè¯ï¼ˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼‰"""
        session = self.SessionLocal()
        try:
            yield session
            session.commit()
        except Exception:
            session.rollback()
            raise
        finally:
            session.close()
```

### 8.3 æ•°æ®ä»“åº“ï¼ˆRepository Patternï¼‰

```python
"""
å•†å“æ•°æ®ä»“åº“

å®ç° CRUD æ“ä½œ
"""

class ProductRepository:
    def __init__(self, db_manager: DatabaseManager):
        self.db_manager = db_manager
        self.logger = get_logger("ProductRepository")
    
    def create(self, product_data: Dict[str, Any]) -> Product:
        """åˆ›å»ºå•†å“"""
        with self.db_manager.get_session() as session:
            product = Product(**product_data)
            session.add(product)
            session.flush()
            self.logger.info(f"åˆ›å»ºå•†å“: {product.sku_id}")
            return product
    
    def get_by_sku(self, sku_id: str) -> Optional[Product]:
        """æ ¹æ® SKU è·å–å•†å“"""
        with self.db_manager.get_session() as session:
            return session.query(Product).filter(Product.sku_id == sku_id).first()
    
    def update(self, sku_id: str, update_data: Dict[str, Any]) -> Optional[Product]:
        """æ›´æ–°å•†å“"""
        with self.db_manager.get_session() as session:
            product = session.query(Product).filter(Product.sku_id == sku_id).first()
            if product:
                for key, value in update_data.items():
                    setattr(product, key, value)
                self.logger.info(f"æ›´æ–°å•†å“: {sku_id}")
            return product
    
    def delete(self, sku_id: str) -> bool:
        """åˆ é™¤å•†å“"""
        with self.db_manager.get_session() as session:
            product = session.query(Product).filter(Product.sku_id == sku_id).first()
            if product:
                session.delete(product)
                self.logger.info(f"åˆ é™¤å•†å“: {sku_id}")
                return True
            return False
    
    def search(self, keyword: str, limit: int = 100) -> List[Product]:
        """æœç´¢å•†å“"""
        with self.db_manager.get_session() as session:
            return (
                session.query(Product)
                .filter(Product.title.like(f"%{keyword}%"))
                .limit(limit)
                .all()
            )
```

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 æµ‹è¯•æ¶æ„

```
æµ‹è¯•å±‚æ¬¡
â”œâ”€â”€ å•å…ƒæµ‹è¯• (Unit Tests)
â”‚   â”œâ”€â”€ æµ‹è¯•å•ä¸ªå‡½æ•°å’Œæ–¹æ³•
â”‚   â””â”€â”€ Mock å¤–éƒ¨ä¾èµ–
â”‚
â”œâ”€â”€ é›†æˆæµ‹è¯• (Integration Tests)
â”‚   â”œâ”€â”€ æµ‹è¯•æ¨¡å—ä¹‹é—´çš„äº¤äº’
â”‚   â””â”€â”€ ä½¿ç”¨çœŸå®æˆ–æµ‹è¯•æ•°æ®åº“
â”‚
â”œâ”€â”€ GUI æµ‹è¯• (GUI Tests)
â”‚   â”œâ”€â”€ ä½¿ç”¨ pytest-qt
â”‚   â””â”€â”€ æµ‹è¯•ç”¨æˆ·äº¤äº’
â”‚
â””â”€â”€ ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
    â”œâ”€â”€ æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
    â””â”€â”€ æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯
```

### 9.2 å•å…ƒæµ‹è¯•ç¤ºä¾‹

```python
"""
é…ç½®ç®¡ç†å™¨å•å…ƒæµ‹è¯•
"""

import pytest
from src.core.config_manager import ConfigManager
from src.core.config import Settings

class TestConfigManager:
    @pytest.fixture
    def config_manager(self, tmp_path):
        """åˆ›å»ºä¸´æ—¶é…ç½®ç®¡ç†å™¨"""
        return ConfigManager(config_dir=tmp_path)
    
    def test_load_config_empty(self, config_manager):
        """æµ‹è¯•åŠ è½½ç©ºé…ç½®"""
        settings = config_manager.load_config()
        assert isinstance(settings, Settings)
        assert settings.app.name == "JDFlows"
    
    def test_save_and_load_config(self, config_manager):
        """æµ‹è¯•ä¿å­˜å’ŒåŠ è½½é…ç½®"""
        settings = Settings(app={"name": "Test App"})
        config_manager.save_config(settings)
        
        loaded = config_manager.load_config()
        assert loaded.app.name == "Test App"
```

### 9.3 GUI æµ‹è¯•ç¤ºä¾‹

```python
"""
Dashboard é¡µé¢ GUI æµ‹è¯•
"""

import pytest
from PyQt6.QtCore import Qt
from src.gui.pages.dashboard_page import DashboardPage

class TestDashboardPage:
    @pytest.fixture
    def page(self, qtbot):
        """åˆ›å»º Dashboard é¡µé¢"""
        page = DashboardPage()
        qtbot.addWidget(page)
        return page
    
    def test_page_creation(self, page):
        """æµ‹è¯•é¡µé¢åˆ›å»º"""
        assert page is not None
        assert page.isVisible()
    
    def test_metric_cards(self, page, qtbot):
        """æµ‹è¯•æŒ‡æ ‡å¡ç‰‡"""
        assert page.cpu_card is not None
        assert page.memory_card is not None
        
        # æ›´æ–°æŒ‡æ ‡
        page.cpu_card.update_value("50%", "æ­£å¸¸")
        assert "50%" in page.cpu_card.value_label.text()
    
    def test_action_buttons(self, page, qtbot):
        """æµ‹è¯•æ“ä½œæŒ‰é’®"""
        start_btn = page.findChild(QPushButton, "start_collection")
        assert start_btn is not None
        
        # æ¨¡æ‹Ÿç‚¹å‡»
        with qtbot.waitSignal(page.collection_started, timeout=1000):
            qtbot.mouseClick(start_btn, Qt.MouseButton.LeftButton)
```

### 9.4 é›†æˆæµ‹è¯•ç¤ºä¾‹

```python
"""
æµè§ˆå™¨ç®¡ç†å™¨å’Œæ•°æ®æå–å™¨é›†æˆæµ‹è¯•
"""

import pytest
from src.automation.browser_manager import BrowserManager
from src.automation.product_extractor import ProductExtractor
from src.core.config import Settings

@pytest.mark.asyncio
class TestBrowserIntegration:
    @pytest.fixture
    async def browser_manager(self):
        """åˆ›å»ºæµè§ˆå™¨ç®¡ç†å™¨"""
        settings = Settings()
        manager = BrowserManager(settings)
        await manager.initialize()
        yield manager
        # æ¸…ç†
        await manager.cleanup()
    
    async def test_extract_product(self, browser_manager):
        """æµ‹è¯•å•†å“æå–"""
        # åˆ›å»ºæµè§ˆå™¨å®ä¾‹
        instance = await browser_manager.create_instance("test")
        
        # æå–å•†å“ä¿¡æ¯
        extractor = ProductExtractor(browser_manager)
        product = await extractor.extract_product_info(
            instance.page,
            "https://item.jd.com/100012043978.html"
        )
        
        assert product is not None
        assert "title" in product
        assert "price" in product
```

---

## 10. éƒ¨ç½²å’Œæ‰“åŒ…

### 10.1 ä½¿ç”¨ PyInstaller æ‰“åŒ…

#### 10.1.1 åˆ›å»º spec æ–‡ä»¶

```python
# jdflows.spec

# -*- mode: python ; coding: utf-8 -*-

block_cipher = None

a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('config', 'config'),
        ('resources', 'resources'),
        ('src/gui/shared_styles.qss', 'src/gui'),
    ],
    hiddenimports=[
        'playwright',
        'qasync',
        'loguru',
        'pydantic',
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.zipfiles,
    a.datas,
    [],
    name='JDFlows',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,  # ä¸æ˜¾ç¤ºæ§åˆ¶å°çª—å£
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon='resources/icons/app_icon.ico',  # åº”ç”¨å›¾æ ‡
)
```

#### 10.1.2 æ‰§è¡Œæ‰“åŒ…

```bash
# ä½¿ç”¨ spec æ–‡ä»¶æ‰“åŒ…
pyinstaller jdflows.spec

# æˆ–ç›´æ¥å‘½ä»¤è¡Œæ‰“åŒ…ï¼ˆç®€å•æ¨¡å¼ï¼‰
pyinstaller --onefile --windowed \
    --icon=resources/icons/app_icon.ico \
    --add-data "config:config" \
    --add-data "resources:resources" \
    --name JDFlows \
    main.py
```

### 10.2 ä½¿ç”¨ cx_Freeze æ‰“åŒ…

```python
# setup.py

from cx_Freeze import setup, Executable
import sys

build_exe_options = {
    "packages": ["PyQt6", "playwright", "sqlalchemy", "pydantic"],
    "include_files": [
        ("config", "config"),
        ("resources", "resources"),
        ("src/gui/shared_styles.qss", "src/gui/shared_styles.qss"),
    ],
    "excludes": ["tkinter", "unittest"],
}

base = None
if sys.platform == "win32":
    base = "Win32GUI"  # ä¸æ˜¾ç¤ºæ§åˆ¶å°

setup(
    name="JDFlows",
    version="0.1.0",
    description="äº¬ä¸œå•†å“é‡‡é›†å’Œè‡ªåŠ¨åŒ–æ¡Œé¢åº”ç”¨",
    options={"build_exe": build_exe_options},
    executables=[
        Executable(
            "main.py",
            base=base,
            icon="resources/icons/app_icon.ico",
            target_name="JDFlows.exe",
        )
    ],
)
```

```bash
# æ‰§è¡Œæ‰“åŒ…
python setup.py build
```

### 10.3 å‘å¸ƒæ¸…å•

æ‰“åŒ…åéœ€è¦åŒ…å«çš„æ–‡ä»¶ï¼š

```
JDFlows-Release/
â”œâ”€â”€ JDFlows.exe           # ä¸»ç¨‹åº
â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ app.json
â”‚   â”œâ”€â”€ system.json
â”‚   â””â”€â”€ user.json
â”œâ”€â”€ resources/            # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ data/                 # æ•°æ®ç›®å½•ï¼ˆé¦–æ¬¡è¿è¡Œåˆ›å»ºï¼‰
â”‚   â””â”€â”€ jdflows.db
â”œâ”€â”€ logs/                 # æ—¥å¿—ç›®å½•ï¼ˆé¦–æ¬¡è¿è¡Œåˆ›å»ºï¼‰
â”œâ”€â”€ README.txt            # ä½¿ç”¨è¯´æ˜
â””â”€â”€ LICENSE.txt           # è®¸å¯è¯
```

---

## 11. å¼€å‘æœ€ä½³å®è·µ

### 11.1 ä»£ç é£æ ¼

#### 11.1.1 éµå¾ª PEP 8 å’Œ Black

```bash
# æ ¼å¼åŒ–ä»£ç 
black src/ tests/

# æ£€æŸ¥ä»£ç è´¨é‡
flake8 src/ tests/

# ç±»å‹æ£€æŸ¥
mypy src/
```

#### 11.1.2 ç±»å‹æ³¨è§£

```python
# å¥½çš„å®è·µ âœ…
def calculate_total(items: List[Dict[str, Any]]) -> float:
    total: float = 0.0
    for item in items:
        total += float(item.get("price", 0))
    return total

# é¿å…çš„åšæ³• âŒ
def calculate_total(items):
    total = 0
    for item in items:
        total += item["price"]
    return total
```

### 11.2 é”™è¯¯å¤„ç†

```python
# å¥½çš„å®è·µ âœ…
async def load_product(sku_id: str) -> Optional[Product]:
    try:
        product = await repository.get_by_sku(sku_id)
        if not product:
            logger.warning(f"å•†å“ä¸å­˜åœ¨: {sku_id}")
            return None
        return product
    except DatabaseError as e:
        logger.error(f"æ•°æ®åº“é”™è¯¯: {e}")
        raise
    except Exception as e:
        logger.error(f"æœªçŸ¥é”™è¯¯: {e}")
        raise ApplicationError("åŠ è½½å•†å“å¤±è´¥") from e

# é¿å…çš„åšæ³• âŒ
async def load_product(sku_id):
    try:
        return await repository.get_by_sku(sku_id)
    except:
        return None
```

### 11.3 æ—¥å¿—è®°å½•

```python
# å¥½çš„å®è·µ âœ…
logger.info(f"å¼€å§‹é‡‡é›†å•†å“, å…³é”®è¯: {keyword}")
logger.debug(f"æµè§ˆå™¨é…ç½®: {browser_config}")
logger.warning(f"å•†å“åº“å­˜ä¸è¶³: {sku_id}")
logger.error(f"é‡‡é›†å¤±è´¥: {error_message}", exc_info=True)

# é¿å…çš„åšæ³• âŒ
print("å¼€å§‹é‡‡é›†")
logger.info(error)  # ä¸åº”è¯¥ç”¨ info è®°å½•é”™è¯¯
```

### 11.4 å¼‚æ­¥ç¼–ç¨‹

```python
# å¥½çš„å®è·µ âœ…
async def process_products(products: List[str]):
    tasks = [extract_product(sku) for sku in products]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    return results

# é¿å…çš„åšæ³• âŒ
async def process_products(products):
    results = []
    for sku in products:
        result = await extract_product(sku)  # ä¸²è¡Œæ‰§è¡Œï¼Œæ•ˆç‡ä½
        results.append(result)
    return results
```

---

## 12. å¸¸è§é—®é¢˜

### 12.1 Playwright å®‰è£…é—®é¢˜

**é—®é¢˜**: `playwright install` å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# è®¾ç½®å›½å†…é•œåƒ
export PLAYWRIGHT_DOWNLOAD_HOST=https://npmmirror.com/mirrors/playwright/

# é‡æ–°å®‰è£…
playwright install chromium
```

### 12.2 PyQt6 å¯¼å…¥é”™è¯¯

**é—®é¢˜**: `ImportError: DLL load failed while importing QtCore`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°å®‰è£… PyQt6
pip uninstall PyQt6 PyQt6-Qt6
pip install PyQt6
```

### 12.3 asyncio å’Œ qasync é›†æˆé—®é¢˜

**é—®é¢˜**: å¼‚æ­¥ä»»åŠ¡ä¸æ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```python
# ç¡®ä¿æ­£ç¡®è®¾ç½®äº‹ä»¶å¾ªç¯
event_loop = qasync.QEventLoop(qt_app)
asyncio.set_event_loop(event_loop)

# è¿è¡Œå¼‚æ­¥ä»»åŠ¡
event_loop.run_until_complete(async_function())
```

### 12.4 æ•°æ®åº“é”å®šé—®é¢˜

**é—®é¢˜**: `database is locked`

**è§£å†³æ–¹æ¡ˆ**:
```python
# è®¾ç½®è¶…æ—¶æ—¶é—´
engine = create_engine(
    "sqlite:///data/jdflows.db",
    connect_args={"timeout": 15}
)

# æˆ–ä½¿ç”¨ WAL æ¨¡å¼
engine = create_engine(
    "sqlite:///data/jdflows.db?mode=wal",
)
```

---

## é™„å½•

### A. å¼€å‘ç¯å¢ƒæ£€æŸ¥æ¸…å•

- [ ] Python 3.11+ å·²å®‰è£…
- [ ] Poetry æˆ– pip å·²å®‰è£…
- [ ] Playwright æµè§ˆå™¨å·²å®‰è£…
- [ ] ä¾èµ–åŒ…å…¨éƒ¨å®‰è£…æˆåŠŸ
- [ ] ä»£ç æ ¼å¼åŒ–å·¥å…·å·²é…ç½®
- [ ] Git é’©å­å·²è®¾ç½®
- [ ] IDE/ç¼–è¾‘å™¨å·²é…ç½®ç±»å‹æ£€æŸ¥

### B. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# è¿è¡Œåº”ç”¨
python main.py

# è¿è¡Œæµ‹è¯•
pytest
pytest --cov=src --cov-report=html

# ä»£ç è´¨é‡
black src/ tests/
flake8 src/ tests/
mypy src/

# æ‰“åŒ…
pyinstaller jdflows.spec
```

### C. å‚è€ƒèµ„æº

- [PyQt6 å®˜æ–¹æ–‡æ¡£](https://www.riverbankcomputing.com/static/Docs/PyQt6/)
- [Playwright Python æ–‡æ¡£](https://playwright.dev/python/)
- [SQLAlchemy æ–‡æ¡£](https://docs.sqlalchemy.org/)
- [Pydantic æ–‡æ¡£](https://docs.pydantic.dev/)
- [qasync GitHub](https://github.com/CabbageDevelopment/qasync)

---

## ç»“è¯­

æœ¬æŒ‡å—æä¾›äº†ä»0å¼€å§‹å¼€å‘ JDFlows é¡¹ç›®çš„å®Œæ•´è·¯å¾„ã€‚éµå¾ªè¿™äº›æŒ‡å¯¼åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œä½ å¯ä»¥æ„å»ºä¸€ä¸ªç¨³å®šã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„æ¡Œé¢åº”ç”¨ç¨‹åºã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestï¼

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸš€
